schema: '2.0'
stages:
  manifests:
    cmd: python tools/run_manifests.py
    deps:
    - path: params.yaml
      hash: md5
      md5: d45b12b2fc9f51164b3a86a0ace56b32
      size: 2441
    - path: tools/make_manifest.py
      hash: md5
      md5: fb68e04f6e04bbd63d9e08f03dc55dfe
      size: 1084
    - path: tools/run_manifests.py
      hash: md5
      md5: 1cef37997aec87a6acf2f0d5be3cec06
      size: 2146
    params:
      params.yaml:
        manifests.features_s3_uri: s3://retail-ml-taljinder-2025/raw/walmart/features/features.csv
        manifests.stores_s3_uri: s3://retail-ml-taljinder-2025/raw/walmart/stores/stores.csv
        manifests.train_s3_uri: s3://retail-ml-taljinder-2025/raw/walmart/train/train.csv
    outs:
    - path: data_manifests/walmart/features.manifest.json
      hash: md5
      md5: 146390a7ae7048b4659d5bde9c78ed87
      size: 219
    - path: data_manifests/walmart/stores.manifest.json
      hash: md5
      md5: 882c34a1ba299d595e664a3fc504a8ae
      size: 213
    - path: data_manifests/walmart/train.manifest.json
      hash: md5
      md5: 74648c0ff934ea46917f67d295a31a97
      size: 215
  split:
    cmd: python src/data/split.py
    deps:
    - path: data_manifests/walmart/features.manifest.json
      hash: md5
      md5: 146390a7ae7048b4659d5bde9c78ed87
      size: 219
    - path: data_manifests/walmart/stores.manifest.json
      hash: md5
      md5: 882c34a1ba299d595e664a3fc504a8ae
      size: 213
    - path: data_manifests/walmart/train.manifest.json
      hash: md5
      md5: 74648c0ff934ea46917f67d295a31a97
      size: 215
    - path: sql/02_create_analytics_view.sql
      hash: md5
      md5: b9055bd3bd9df8c14de17a442e2b2886
      size: 723
    - path: src/config.py
      hash: md5
      md5: d664b8c0c2a947977d7a2a92c779d855
      size: 1166
    - path: src/data/split.py
      hash: md5
      md5: a7655c6fef6e6a550cee8eb2f6928a1b
      size: 15160
    params:
      params.yaml:
        split.train_end_date: '2011-12-31'
        split.val_end_date: '2012-06-30'
    outs:
    - path: data/splits/test.csv
      hash: md5
      md5: 3fe8874db712ab42d8cfdc057932694a
      size: 5063342
    - path: data/splits/train.csv
      hash: md5
      md5: cea761d26ef8852b938db92077afdfa0
      size: 22382198
    - path: data/splits/val.csv
      hash: md5
      md5: 7c2ec3a053200a0362f81b1d917d42af
      size: 7866139
  eda:
    cmd: python src/eda/eda.py
    deps:
    - path: data/splits/test.csv
      hash: md5
      md5: 3fe8874db712ab42d8cfdc057932694a
      size: 5063342
    - path: data/splits/train.csv
      hash: md5
      md5: cea761d26ef8852b938db92077afdfa0
      size: 22382198
    - path: data/splits/val.csv
      hash: md5
      md5: 7c2ec3a053200a0362f81b1d917d42af
      size: 7866139
    - path: src/eda/eda.py
      hash: md5
      md5: e9f3dbf724d91bb18db51c3c9031496c
      size: 17735
    outs:
    - path: reports/eda/figures
      hash: md5
      md5: b84c537233134e77b807dce83a30739a.dir
      size: 1364421
      nfiles: 8
    - path: reports/eda/tables
      hash: md5
      md5: ecbcabcb940fb37518cd58cca53bdd8b.dir
      size: 806101
      nfiles: 17
  features:
    cmd: python src/features/feature_eng.py
    deps:
    - path: data/splits/test.csv
      hash: md5
      md5: 3fe8874db712ab42d8cfdc057932694a
      size: 5063342
    - path: data/splits/train.csv
      hash: md5
      md5: cea761d26ef8852b938db92077afdfa0
      size: 22382198
    - path: data/splits/val.csv
      hash: md5
      md5: 7c2ec3a053200a0362f81b1d917d42af
      size: 7866139
    - path: params.yaml
      hash: md5
      md5: d45b12b2fc9f51164b3a86a0ace56b32
      size: 2441
    - path: src/config.py
      hash: md5
      md5: d664b8c0c2a947977d7a2a92c779d855
      size: 1166
    - path: src/features/feature_eng.py
      hash: md5
      md5: 47e801a706c33eaccd64fb41c37053b9
      size: 24494
    params:
      params.yaml:
        features.lags:
        - 1
        - 2
        - 4
        - 52
        features.negative_sales_strategy: clip
        features.rolling_windows:
        - 4
        - 8
    outs:
    - path: data/splits/test_features.csv
      hash: md5
      md5: a0f03ceb6b4ec877aa23c6be8c78c483
      size: 19407095
    - path: data/splits/train_features.csv
      hash: md5
      md5: ae8decaf5159a3382f285eae19fbce0e
      size: 92178202
    - path: data/splits/val_features.csv
      hash: md5
      md5: 126cd3e237f67d83e0020c243abed6b7
      size: 29800633
  baselines:
    cmd: python src/model/run_baselines.py
    deps:
    - path: data/splits/train.csv
      hash: md5
      md5: cea761d26ef8852b938db92077afdfa0
      size: 22382198
    - path: data/splits/val.csv
      hash: md5
      md5: 7c2ec3a053200a0362f81b1d917d42af
      size: 7866139
    - path: src/config.py
      hash: md5
      md5: d664b8c0c2a947977d7a2a92c779d855
      size: 1166
    - path: src/model/baseline.py
      hash: md5
      md5: 577a103dc705253887ab8dffe9a5bd2d
      size: 12036
    - path: src/model/evaluate.py
      hash: md5
      md5: f518e9d3a480176fae84486b1e9fc585
      size: 10473
    - path: src/model/run_baselines.py
      hash: md5
      md5: 4b967189c33a47b1bba43b524a5a26a5
      size: 7315
    params:
      params.yaml:
        evaluation.holiday_weight: 5.0
    outs:
    - path: data/baseline_results.csv
      hash: md5
      md5: ba6f4cdf1f180d8f25b456250a879497
      size: 630
    - path: data/baseline_segments_all.csv
      hash: md5
      md5: 66d64c004d12147dd3de65881fdc3ce7
      size: 7534
  train:
    cmd: python src/model/train.py
    deps:
    - path: data/baseline_results.csv
      hash: md5
      md5: ba6f4cdf1f180d8f25b456250a879497
      size: 630
    - path: data/splits/test_features.csv
      hash: md5
      md5: a0f03ceb6b4ec877aa23c6be8c78c483
      size: 19407095
    - path: data/splits/train_features.csv
      hash: md5
      md5: ae8decaf5159a3382f285eae19fbce0e
      size: 92178202
    - path: data/splits/val_features.csv
      hash: md5
      md5: 126cd3e237f67d83e0020c243abed6b7
      size: 29800633
    - path: params.yaml
      hash: md5
      md5: d45b12b2fc9f51164b3a86a0ace56b32
      size: 2441
    - path: src/config.py
      hash: md5
      md5: d664b8c0c2a947977d7a2a92c779d855
      size: 1166
    - path: src/model/evaluate.py
      hash: md5
      md5: f518e9d3a480176fae84486b1e9fc585
      size: 10473
    - path: src/model/train.py
      hash: md5
      md5: ce11293d8a4989553e87c9f76065ae3a
      size: 45963
    params:
      params.yaml:
        evaluation.holiday_weight: 5.0
        models.catboost:
          param_grid:
          - learning_rate: 0.05
            depth: 6
          - learning_rate: 0.03
            depth: 8
          - learning_rate: 0.1
            depth: 4
          iterations: 1000
          early_stopping_rounds: 50
        models.ensemble:
          method: weighted
        models.lightgbm:
          param_grid:
          - num_leaves: 31
            learning_rate: 0.05
            feature_fraction: 0.9
            bagging_fraction: 0.8
          - num_leaves: 50
            learning_rate: 0.03
            feature_fraction: 0.8
            bagging_fraction: 0.7
          - num_leaves: 20
            learning_rate: 0.1
            feature_fraction: 0.95
            bagging_fraction: 0.85
          num_boost_round: 1000
          early_stopping_rounds: 50
          bagging_freq: 5
        models.linear:
          alphas:
          - 0.1
          - 0.5
          - 1.0
          - 5.0
          - 10.0
          - 50.0
          - 100.0
        models.xgboost:
          param_grid:
          - learning_rate: 0.05
            max_depth: 6
            subsample: 0.8
          - learning_rate: 0.03
            max_depth: 8
            subsample: 0.7
          - learning_rate: 0.1
            max_depth: 4
            subsample: 0.9
          n_estimators: 1000
          early_stopping_rounds: 50
    outs:
    - path: data/final_test_results.json
      hash: md5
      md5: e72067191da15c4bb2267b6385d9b303
      size: 231
    - path: data/mlflow_run_id.txt
      hash: md5
      md5: 87c4f965a9df613428221ce16fa0604b
      size: 32
    - path: data/model_comparison.csv
      hash: md5
      md5: d60ded276ef55faffe9087d42f4b9edb
      size: 630
    - path: data/test_predictions.csv
      hash: md5
      md5: 392f844ae55000f5400ab371fd8c5dd2
      size: 1323975
    - path: data/test_predictions_all
      hash: md5
      md5: 5bcfdf3ac10fd36e97fa1280aa6bfa02.dir
      size: 4851668
      nfiles: 4
    - path: models
      hash: md5
      md5: 92afd3f291e7aea28d3d3237edc2e681.dir
      size: 18505109
      nfiles: 2
  evaluate:
    cmd: python src/model/evaluate_models.py
    deps:
    - path: data/final_test_results.json
      hash: md5
      md5: e72067191da15c4bb2267b6385d9b303
      size: 231
    - path: data/mlflow_run_id.txt
      hash: md5
      md5: 87c4f965a9df613428221ce16fa0604b
      size: 32
    - path: data/model_comparison.csv
      hash: md5
      md5: d60ded276ef55faffe9087d42f4b9edb
      size: 630
    - path: data/splits/test_features.csv
      hash: md5
      md5: a0f03ceb6b4ec877aa23c6be8c78c483
      size: 19407095
    - path: data/test_predictions_all
      hash: md5
      md5: 5bcfdf3ac10fd36e97fa1280aa6bfa02.dir
      size: 4851668
      nfiles: 4
    - path: src/config.py
      hash: md5
      md5: d664b8c0c2a947977d7a2a92c779d855
      size: 1166
    - path: src/model/evaluate.py
      hash: md5
      md5: f518e9d3a480176fae84486b1e9fc585
      size: 10473
    - path: src/model/evaluate_models.py
      hash: md5
      md5: cdc88b005dbdf39a58bc5e4d00fd8811
      size: 8537
    params:
      params.yaml:
        evaluation.holiday_weight: 5.0
        evaluation.n_plot_samples: 5
    outs:
    - path: reports/figures
      hash: md5
      md5: 82fcb54a62a8f156a276b806ff544348.dir
      size: 144100
      nfiles: 2
    - path: reports/model_evaluation_report.csv
      hash: md5
      md5: d41c686c4e0c68d4bbd78663293abba0
      size: 386
